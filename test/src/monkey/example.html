<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Monkey Interpreter</title>
    <script src="wasm_exec.js"></script>
    <script>
      // Initialize the Go WASM runtime
      const go = new Go();

      // Load and instantiate the WASM module
      WebAssembly.instantiateStreaming(
        fetch("interpreter.wasm"),
        go.importObject
      )
        .then((result) => {
          go.run(result.instance);
          console.log("WASM loaded successfully");
          document.getElementById("status").textContent = "Ready";
          document.getElementById("run").disabled = false;
        })
        .catch((err) => {
          console.error("Failed to load WASM:", err);
          document.getElementById("status").textContent = "Error loading WASM";
        });

      // Function to run Monkey code
      function runMonkeyCode() {
        try {
          const code = document.getElementById("code").value;
          const result = goInterpret(code);
          document.getElementById("result").textContent = result;
        } catch (err) {
          document.getElementById("result").textContent =
            "Error: " + err.message;
        }
      }
    </script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      h1 {
        color: #333;
      }
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-family: monospace;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      pre {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        overflow: auto;
      }
      .status {
        font-style: italic;
        color: #666;
      }
      .examples {
        margin-top: 20px;
      }
      .example {
        cursor: pointer;
        color: blue;
        text-decoration: underline;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Monkey Language Interpreter</h1>
    <p class="status">Status: <span id="status">Loading...</span></p>

    <h2>Code</h2>
    <textarea id="code" rows="10">
let x = 5;
let y = 10;
x + y;</textarea
    >

    <div>
      <button id="run" onclick="runMonkeyCode()" disabled>Run</button>
    </div>

    <h2>Result</h2>
    <pre id="result"></pre>

    <div class="examples">
      <h2>Examples</h2>
      <span class="example" onclick="loadExample('arithmetic')"
        >Arithmetic</span
      >
      <span class="example" onclick="loadExample('functions')">Functions</span>
      <span class="example" onclick="loadExample('arrays')">Arrays</span>
      <span class="example" onclick="loadExample('hashes')">Hashes</span>
      <span class="example" onclick="loadExample('conditionals')"
        >Conditionals</span
      >
    </div>

    <script>
      // Example code snippets
      const examples = {
        arithmetic: `let x = 5;
let y = 10;
let z = x + y * 2;
z;`,
        functions: `let add = fn(a, b) { a + b; };
let multiply = fn(a, b) { a * b; };
let calculate = fn(a, b, func) { func(a, b); };

calculate(5, 10, add);`,
        arrays: `let arr = [1, 2, 3, 4, 5];
let sum = fn(array) {
    let result = 0;
    let i = 0;
    while (i < len(array)) {
        result = result + array[i];
        i = i + 1;
    }
    return result;
};
sum(arr);`,
        hashes: `let person = {"name": "Monkey", "age": 1, "hobbies": ["coding", "bananas"]};
person["name"];
person["hobbies"][1];`,
        conditionals: `let x = 10;
let y = 5;

if (x > y) {
    "x is greater than y";
} else {
    "y is greater than or equal to x";
}`,
      };

      // Function to load example code
      function loadExample(name) {
        if (examples[name]) {
          document.getElementById("code").value = examples[name];
        }
      }
    </script>
  </body>
</html>
